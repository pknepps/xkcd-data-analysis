knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(warning = FALSE)
xkcd_characters |>
filter(str_detect(names, "hat") | str_detect(scene, "hat")) |>
filter(!str_detect(names, "boy|white") | !str_detect(scene, "boy|white")) |>
distinct(num) |>
count()
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(warning = FALSE)
if (!require("tidyverse")) {
install.packages("tidyverse")
}
if (!require("ggwordcloud")) {
install.packages("ggwordcloud")
}
library("tidyverse")
xkcd <- read.csv("xkcd.csv", quote = "")
nrow(xkcd)
xkcd_date <- xkcd |> unite(date, month, day, year, sep = "-") |> mutate(date = as.Date(mdy(date))) |> mutate(weekday = wday(date, label = TRUE),.after = date)
view_xkcd_string <- function(strin) {
str_replace_all(strin, r"{\\n}", "\n") |> str_view()
}
scenebuilding = r"{\[\[([^\]]*)\]\]}"
dialog_regex = r"{(?:\\n)?([^:]+): ((?:.(?!\\n[^:]+:))*.)}"
# THIS IS THE NAME REGEX
names_regex = r"{(?:\\n)(?=(?:.(?!\\n))+:)([^:]+):}"
bad_newlines = r"{(?:\\n)(?!(?:.(?!\\n))+:)}"
parse_dialog <- function(dialog) {
step0 = str_replace_all(dialog, r"{(?:\\n)+}", r"{\\n}")
step1 = str_remove_all(step0, r"(^\s+"|\{\{.*\}\}"?$)")
scene_info = str_match_all(step1, scenebuilding)
step2.1 = str_remove_all(step1, scenebuilding)
step2.2 = str_replace_all(step2.1, r"{(?:\\n)+}", r"{\\n}")
step2.3 = str_remove(step2.2, r"(\s*(?:\\n)+$)")
names = str_match_all(step2.3, names_regex)
dialog = str_split(step2.3, names_regex)
n <- names |> map(\(x) reduce(x[,2], function(x, y) paste(x, y, sep = "|||"), .init="")) |> unlist()
d <- dialog |> map(\(x) reduce(x, paste, .init="")) |> unlist()
s <- scene_info |> map(\(x) reduce(x[,2], paste, .init="")) |> unlist()
data.frame(names = n, dialog= d, scene=s)
}
# sample <- xkcd |> sample_n(10) |> pull(transcript)
xkcd_comma <- xkcd_date |> mutate(transcript = transcript |> str_replace_all("\\(COMMA\\)", ","))
#
# mutate_and_parse = function(df) {
#     split_transcript = df$transcript |> parse_dialog() |> map(as.data.frame)
#     speakers = split_transcript |> map(\(x) reduce(x$V2, paste, .init = "")) |> unlist()
#     script = split_transcript |> map(\(x) reduce(x$V3, paste, .init = "")) |> unlist()
#     return(data.frame(speakers, script))
# }
xkcd_transcript <- xkcd_comma |> cbind(xkcd_comma |> pull(transcript) |> parse_dialog())
head(xkcd_transcript)
# we extract the year from the given date by using format(date), "%y"
xkcd_date |> mutate(year = format(date, "%Y")) |> ggplot(aes(year)) + geom_bar() + labs(title = "Number of Comics Posted by Year")
# graph for posts by day of the week
xkcd_date |> ggplot(aes(weekday)) + geom_bar() + labs(title = "Number of Comics Posted by Weekday")
xkcd_date |> filter(format(date, "%Y") == "2006") |> group_by(date) |> count() |> arrange(desc(n)) |> head()
xkcd_date_abnormal <- xkcd_date |> filter(weekday %in% c("Sun", "Tue", "Thu", "Sat"), date != "2006-01-01")
xkcd_date_abnormal |> group_by(weekday) |> count()
xkcd_date_abnormal |> group_by(format(date, "%Y"), weekday) |> count()
(xkcd_date_abnormal |> filter(format(date, "%Y") > 2018))[c(1:4, 8:10)]
specialComics <- xkcd_date |> filter(extra_parts != " NA")
hasNews <- xkcd_date |> filter(news != " NA")
hasLink <- xkcd_date |> filter(link != " NA")
special_union <- union(union(specialComics, hasNews), hasLink)
nrow(specialComics)
nrow(hasNews)
nrow(hasLink)
nrow(special_union)
nrow(intersect(specialComics, hasNews))
nrow(intersect(specialComics, hasLink))
nrow(intersect(hasNews, hasLink))
nrow(intersect(specialComics, intersect(hasNews, hasLink)))
special_union |> mutate(year = format(date, "%Y")) |> ggplot(aes(year)) + geom_bar() + labs(title = "Comics with Unique Properties by Year")
specialComics |> mutate(year = format(date, "%Y")) |> ggplot(aes(year)) + geom_bar() + labs(title = "Special Comics by Year")
hasLink |> mutate(year = format(date, "%Y")) |> ggplot(aes(year)) + geom_bar() + labs(title = "Comics with Links by Year")
hasNews |> mutate(year = format(date, "%Y")) |> ggplot(aes(year)) + geom_bar() + labs(title = "Comics with News by Year")
special_union |> ggplot(aes(weekday)) + geom_bar() + labs(title = "Comics with Unique Properties by Weekday")
nrow(union(special_union, xkcd_date_abnormal))
nrow(intersect(special_union, xkcd_date_abnormal)) / nrow(xkcd_date_abnormal)
nrow(special_union) / nrow(xkcd)
xkcd_title_diff <- xkcd_date |> filter(title != safe_title)
xkcd_title_diff[1:5]
xkcd_words <- xkcd_transcript |> separate_longer_delim(dialog, delim = regex(r"(\s+)")) |> mutate(dialog = tolower(dialog) |> str_replace_all("[^[\\w+]]", "") |> na_if("")) |> filter(!is.na(dialog))
word_frequency <- xkcd_words |> group_by(dialog) |> count() |> arrange(desc(n))
word_frequency[250:500,] |> ggplot(aes(label = dialog, size = n)) + geom_text_wordcloud() + theme_minimal()
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(warning = FALSE)
if (!require("tidyverse")) {
install.packages("tidyverse")
}
if (!require("ggwordcloud")) {
install.packages("ggwordcloud")
}
library("tidyverse")
xkcd <- read.csv("xkcd.csv", quote = "")
nrow(xkcd)
xkcd_date <- xkcd |> unite(date, month, day, year, sep = "-") |> mutate(date = as.Date(mdy(date))) |> mutate(weekday = wday(date, label = TRUE),.after = date)
view_xkcd_string <- function(strin) {
str_replace_all(strin, r"{\\n}", "\n") |> str_view()
}
scenebuilding = r"{\[\[([^\]]*)\]\]}"
dialog_regex = r"{(?:\\n)?([^:]+): ((?:.(?!\\n[^:]+:))*.)}"
# THIS IS THE NAME REGEX
names_regex = r"{(?:\\n)(?=(?:.(?!\\n))+:)([^:]+):}"
bad_newlines = r"{(?:\\n)(?!(?:.(?!\\n))+:)}"
parse_dialog <- function(dialog) {
step0 = str_replace_all(dialog, r"{(?:\\n)+}", r"{\\n}")
step1 = str_remove_all(step0, r"(^\s+"|\{\{.*\}\}"?$)")
scene_info = str_match_all(step1, scenebuilding)
step2.1 = str_remove_all(step1, scenebuilding)
step2.2 = str_replace_all(step2.1, r"{(?:\\n)+}", r"{\\n}")
step2.3 = str_remove(step2.2, r"(\s*(?:\\n)+$)")
names = str_match_all(step2.3, names_regex)
dialog = str_split(step2.3, names_regex)
n <- names |> map(\(x) reduce(x[,2], function(x, y) paste(x, y, sep = "|||"), .init="")) |> unlist()
d <- dialog |> map(\(x) reduce(x, paste, .init="")) |> unlist()
s <- scene_info |> map(\(x) reduce(x[,2], paste, .init="")) |> unlist()
data.frame(names = n, dialog= d, scene=s)
}
# sample <- xkcd |> sample_n(10) |> pull(transcript)
xkcd_comma <- xkcd_date |> mutate(transcript = transcript |> str_replace_all("\\(COMMA\\)", ","))
#
# mutate_and_parse = function(df) {
#     split_transcript = df$transcript |> parse_dialog() |> map(as.data.frame)
#     speakers = split_transcript |> map(\(x) reduce(x$V2, paste, .init = "")) |> unlist()
#     script = split_transcript |> map(\(x) reduce(x$V3, paste, .init = "")) |> unlist()
#     return(data.frame(speakers, script))
# }
xkcd_transcript <- xkcd_comma |> cbind(xkcd_comma |> pull(transcript) |> parse_dialog())
head(xkcd_transcript)
# we extract the year from the given date by using format(date), "%y"
xkcd_date |> mutate(year = format(date, "%Y")) |> ggplot(aes(year)) + geom_bar() + labs(title = "Number of Comics Posted by Year")
# graph for posts by day of the week
xkcd_date |> ggplot(aes(weekday)) + geom_bar() + labs(title = "Number of Comics Posted by Weekday")
xkcd_date |> filter(format(date, "%Y") == "2006") |> group_by(date) |> count() |> arrange(desc(n)) |> head()
xkcd_date_abnormal <- xkcd_date |> filter(weekday %in% c("Sun", "Tue", "Thu", "Sat"), date != "2006-01-01")
xkcd_date_abnormal |> group_by(weekday) |> count()
xkcd_date_abnormal |> group_by(format(date, "%Y"), weekday) |> count()
(xkcd_date_abnormal |> filter(format(date, "%Y") > 2018))[c(1:4, 8:10)]
specialComics <- xkcd_date |> filter(extra_parts != " NA")
hasNews <- xkcd_date |> filter(news != " NA")
hasLink <- xkcd_date |> filter(link != " NA")
special_union <- union(union(specialComics, hasNews), hasLink)
nrow(specialComics)
nrow(hasNews)
nrow(hasLink)
nrow(special_union)
nrow(intersect(specialComics, hasNews))
nrow(intersect(specialComics, hasLink))
nrow(intersect(hasNews, hasLink))
nrow(intersect(specialComics, intersect(hasNews, hasLink)))
special_union |> mutate(year = format(date, "%Y")) |> ggplot(aes(year)) + geom_bar() + labs(title = "Comics with Unique Properties by Year")
specialComics |> mutate(year = format(date, "%Y")) |> ggplot(aes(year)) + geom_bar() + labs(title = "Special Comics by Year")
hasLink |> mutate(year = format(date, "%Y")) |> ggplot(aes(year)) + geom_bar() + labs(title = "Comics with Links by Year")
hasNews |> mutate(year = format(date, "%Y")) |> ggplot(aes(year)) + geom_bar() + labs(title = "Comics with News by Year")
special_union |> ggplot(aes(weekday)) + geom_bar() + labs(title = "Comics with Unique Properties by Weekday")
nrow(union(special_union, xkcd_date_abnormal))
nrow(intersect(special_union, xkcd_date_abnormal)) / nrow(xkcd_date_abnormal)
nrow(special_union) / nrow(xkcd)
xkcd_title_diff <- xkcd_date |> filter(title != safe_title)
xkcd_title_diff[1:5]
xkcd_words <- xkcd_transcript |> separate_longer_delim(dialog, delim = regex(r"(\s+)")) |> mutate(dialog = tolower(dialog) |> str_replace_all("[^[\\w+]]", "") |> na_if("")) |> filter(!is.na(dialog))
word_frequency <- xkcd_words |> group_by(dialog) |> count() |> arrange(desc(n))
xkcd_characters <- xkcd_transcript |> separate_longer_delim(names, delim = "|||") |> mutate(names = str_squish(names) |> tolower() |> na_if("")) |> filter(!is.na(names))
character_freq <- xkcd_characters |> group_by(names) |> count() |> arrange(desc(n))
character_freq
black_hat_guys <- character_freq |> filter(str_detect(names, ".*hat.*")) |> filter(str_detect(names, ".*black.*")); black_hat_guys
black_hat_guys |> ungroup() |> summarize(black_hat_count = sum(n))
xkcd_characters |>
filter(str_detect(names, "hat") | str_detect(scene, "hat")) |>
filter(!str_detect(names, "boy|white") | !str_detect(scene, "boy|white")) |>
distinct(num) |>
count()
black_hat <- xkcd_characters |>
filter(str_detect(names, "hat") | str_detect(scene, "hat")) |>
filter(!str_detect(names, "boy|white") | !str_detect(scene, "boy|white"))
black_hat <- xkcd_characters |>
filter(str_detect(names, "hat") | str_detect(scene, "hat")) |>
filter(!str_detect(names, "boy|white") | !str_detect(scene, "boy|white"))
black_hat
black_hat <- xkcd_characters |>
filter(str_detect(names, "hat") | str_detect(scene, "hat")) |>
filter(!str_detect(names, "boy|white") | !str_detect(scene, "boy|white")) |> group_by(num, date, weekday, title)
black_hat
black_hat <- xkcd_characters |>
filter(str_detect(names, "hat") | str_detect(scene, "hat")) |>
filter(!str_detect(names, "boy|white") | !str_detect(scene, "boy|white")) |> group_by(num, date, weekday, title) |> count()
black_hat <- xkcd_characters |>
filter(str_detect(names, "hat") | str_detect(scene, "hat")) |>
filter(!str_detect(names, "boy|white") | !str_detect(scene, "boy|white")) |> group_by(num, date, weekday, title) |> count()
black_hat
black_hat <- xkcd_characters |>
filter((str_detect(names, "hat") & str_detect(names, "man|guy")) | (str_detect(scene, "hat") & str_detect("man|guy"))) |>
filter(!str_detect(names, "boy|white") | !str_detect(scene, "boy|white")) |> group_by(num, date, weekday, title) |> count()
black_hat <- xkcd_characters |>
filter((str_detect(names, "hat") & str_detect(names, "man|guy")) | (str_detect(scene, "hat") & str_detect(scene, "man|guy"))) |>
filter(!str_detect(names, "boy|white") | !str_detect(scene, "boy|white")) |> group_by(num, date, weekday, title) |> count()
black_hat
black_hat <- xkcd_characters |>
filter((str_detect(names, "hat") & str_detect(names, "black|man|guy")) | (str_detect(scene, "hat") & str_detect(scene, "black|man|guy"))) |>
filter(!str_detect(names, "boy|white") | !str_detect(scene, "boy|white")) |> group_by(num, date, weekday, title) |> count()
black_hat
black_hat <- xkcd_characters |>
filter((str_detect(names, "\\bhat\\b") & str_detect(names, "black|man|guy")) | (str_detect(scene, "hat") & str_detect(scene, "black|man|guy"))) |>
filter(!str_detect(names, "boy|white") | !str_detect(scene, "boy|white")) |> group_by(num, date, weekday, title) |> count()
black_hat
black_hat <- xkcd_characters |>
filter((str_detect(names, "\\bhat\\b") & str_detect(names, "black|man|guy")) | (str_detect(scene, "\\bhat\\b") & str_detect(scene, "black|man|guy"))) |>
filter(!str_detect(names, "boy|white") | !str_detect(scene, "boy|white")) |> group_by(num, date, weekday, title) |> count()
black_hat
black_hat <- xkcd_characters |>
filter((str_detect(names, "\\bhat\\b") & str_detect(names, "black|man|guy")) | (str_detect(scene, "\\bhat\\b") & str_detect(scene, "black|man|guy"))) |>
filter(!str_detect(names, "boy|white")) |> group_by(num, date, weekday, title) |> count()
black_hat
black_hat <- xkcd_characters |>
filter((str_detect(names, "\\bhat\\b") & str_detect(names, "black|man|guy")) | (str_detect(scene, "\\bhat\\b") & str_detect(scene, "black|man|guy"))) |>
filter(!str_detect(names, "boy|white") | !str_detect(scene, "boy|white")) |> group_by(num, date, weekday, title) |> count()
black_hat
black_hat <- xkcd_characters |>
filter((str_detect(names, "\\bhat\\b") & str_detect(names, "black|man|guy")) | (str_detect(scene, "\\bhat\\b") & str_detect(scene, "black|man|guy"))) |>
filter(!str_detect(names, "boy|white")) |> group_by(num, date, weekday, title) |> count()
black_hat
black_hat <- xkcd_characters |>
filter((str_detect(names, "\\bhat\\b") & str_detect(names, "black|man|guy")) | (str_detect(scene, "\\bhat\\b") & str_detect(scene, "black|man|guy"))) |>
filter(!str_detect(names, "boy|white")) |> group_by(num, date, weekday, title) |> count()
black_hat |> ggplot(aes(format(date, "%Y"))) + geom_density()
black_hat <- xkcd_characters |>
filter((str_detect(names, "\\bhat\\b") & str_detect(names, "black|man|guy")) | (str_detect(scene, "\\bhat\\b") & str_detect(scene, "black|man|guy"))) |>
filter(!str_detect(names, "boy|white")) |> group_by(num, date, weekday, title) |> count()
black_hat |> ungroup() |> ggplot(aes(format(date, "%Y"))) + geom_density()
black_hat <- xkcd_characters |>
filter((str_detect(names, "\\bhat\\b") & str_detect(names, "black|man|guy")) | (str_detect(scene, "\\bhat\\b") & str_detect(scene, "black|man|guy"))) |>
filter(!str_detect(names, "boy|white")) |> group_by(num, date, weekday, title) |> count()
black_hat |> ggplot(aes(format(date, "%Y"))) + geom_histogram()
black_hat <- xkcd_characters |>
filter((str_detect(names, "\\bhat\\b") & str_detect(names, "black|man|guy")) | (str_detect(scene, "\\bhat\\b") & str_detect(scene, "black|man|guy"))) |>
filter(!str_detect(names, "boy|white")) |> group_by(num, date, weekday, title) |> count()
black_hat |> ggplot(aes(date))) + geom_histogram()
black_hat <- xkcd_characters |>
filter((str_detect(names, "\\bhat\\b") & str_detect(names, "black|man|guy")) | (str_detect(scene, "\\bhat\\b") & str_detect(scene, "black|man|guy"))) |>
filter(!str_detect(names, "boy|white")) |> group_by(num, date, weekday, title) |> count()
black_hat |> ggplot(aes(date)) + geom_histogram()
black_hat <- xkcd_characters |>
filter((str_detect(names, "\\bhat\\b") & str_detect(names, "black|man|guy")) | (str_detect(scene, "\\bhat\\b") & str_detect(scene, "black|man|guy"))) |>
filter(!str_detect(names, "boy|white")) |> group_by(num, date, weekday, title) |> count()
black_hat |> ggplot(aes(date, fill = date)) + geom_histogram() + lab(title = "Black Hat Man Appearances over time")
black_hat <- xkcd_characters |>
filter((str_detect(names, "\\bhat\\b") & str_detect(names, "black|man|guy")) | (str_detect(scene, "\\bhat\\b") & str_detect(scene, "black|man|guy"))) |>
filter(!str_detect(names, "boy|white")) |> group_by(num, date, weekday, title) |> count()
black_hat |> ggplot(aes(date, fill = date)) + geom_histogram() + labs(title = "Black Hat Man Appearances over time")
black_hat <- xkcd_characters |>
filter((str_detect(names, "\\bhat\\b") & str_detect(names, "black|man|guy")) | (str_detect(scene, "\\bhat\\b") & str_detect(scene, "black|man|guy"))) |>
filter(!str_detect(names, "boy|white")) |> group_by(num, date, weekday, title) |> count()
black_hat |> ggplot(aes(date, color = date)) + geom_histogram() + labs(title = "Black Hat Man Appearances over time")
black_hat <- xkcd_characters |>
filter((str_detect(names, "\\bhat\\b") & str_detect(names, "black|man|guy")) | (str_detect(scene, "\\bhat\\b") & str_detect(scene, "black|man|guy"))) |>
filter(!str_detect(names, "boy|white")) |> group_by(num, date, weekday, title) |> count()
black_hat |> ggplot(aes(date)) + geom_histogram(fill = rainbow()) + labs(title = "Black Hat Man Appearances over time")
black_hat <- xkcd_characters |>
filter((str_detect(names, "\\bhat\\b") & str_detect(names, "black|man|guy")) | (str_detect(scene, "\\bhat\\b") & str_detect(scene, "black|man|guy"))) |>
filter(!str_detect(names, "boy|white")) |> group_by(num, date, weekday, title) |> count()
black_hat |> ggplot(aes(date)) + geom_histogram(fill = rainbow(nu = bins)) + labs(title = "Black Hat Man Appearances over time")
black_hat <- xkcd_characters |>
filter((str_detect(names, "\\bhat\\b") & str_detect(names, "black|man|guy")) | (str_detect(scene, "\\bhat\\b") & str_detect(scene, "black|man|guy"))) |>
filter(!str_detect(names, "boy|white")) |> group_by(num, date, weekday, title) |> count()
black_hat |> ggplot(aes(date)) + geom_histogram(fill = rainbow(nu_bins)) + labs(title = "Black Hat Man Appearances over time")
black_hat <- xkcd_characters |>
filter((str_detect(names, "\\bhat\\b") & str_detect(names, "black|man|guy")) | (str_detect(scene, "\\bhat\\b") & str_detect(scene, "black|man|guy"))) |>
filter(!str_detect(names, "boy|white")) |> group_by(num, date, weekday, title) |> count()
black_hat |> ggplot(aes(date)) + geom_histogram(fill = black) + labs(title = "Black Hat Man Appearances over time")
black_hat <- xkcd_characters |>
filter((str_detect(names, "\\bhat\\b") & str_detect(names, "black|man|guy")) | (str_detect(scene, "\\bhat\\b") & str_detect(scene, "black|man|guy"))) |>
filter(!str_detect(names, "boy|white")) |> group_by(num, date, weekday, title) |> count()
black_hat |> ggplot(aes(date)) + geom_histogram(fill = "black") + labs(title = "Black Hat Man Appearances over time")
black_hat <- xkcd_characters |>
filter((str_detect(names, "\\bhat\\b") & str_detect(names, "black|man|guy")) | (str_detect(scene, "\\bhat\\b") & str_detect(scene, "black|man|guy"))) |>
filter(!str_detect(names, "boy|white")) |> group_by(num, date, weekday, title) |> count()
black_hat |> ggplot(aes(date)) + geom_histogram(fill = "black", binwidth = 1) + labs(title = "Black Hat Man Appearances over time")
black_hat <- xkcd_characters |>
filter((str_detect(names, "\\bhat\\b") & str_detect(names, "black|man|guy")) | (str_detect(scene, "\\bhat\\b") & str_detect(scene, "black|man|guy"))) |>
filter(!str_detect(names, "boy|white")) |> group_by(num, date, weekday, title) |> count()
black_hat |> ggplot(aes(date)) + geom_histogram(fill = "black", binwidth = 365) + labs(title = "Black Hat Man Appearances over time")
black_hat |> ggplot(aes(date)) + geom_density()
black_hat <- xkcd_characters |>
filter((str_detect(names, "\\bhat\\b") & str_detect(names, "black|man|guy")) | (str_detect(scene, "\\bhat\\b") & str_detect(scene, "black|man|guy"))) |>
filter(!str_detect(names, "boy|white")) |> group_by(num, date, weekday, title) |> count()
black_hat |> ggplot(aes(date)) + geom_histogram(fill = "black", binwidth = 365) + labs(title = "Black Hat Man Appearances over time")
black_hat |> ggplot(aes(date)) + geom_density()
black_hat |> ggplot(aes(date)) + geom_histogram(fill = "black", binwidth = 365) + labs(title = "Black Hat Man Appearances over time") + density(fill = "red")
black_hat |> ggplot(aes(date)) + geom_histogram(fill = "black", binwidth = 365) + density(fill = "red") + labs(title = "Black Hat Man Appearances over time")
black_hat <- xkcd_characters |>
filter((str_detect(names, "\\bhat\\b") & str_detect(names, "black|man|guy")) | (str_detect(scene, "\\bhat\\b") & str_detect(scene, "black|man|guy"))) |>
filter(!str_detect(names, "boy|white")) |> group_by(num, date, weekday, title) |> count()
black_hat |> ggplot(aes(date)) + geom_histogram(fill = "black", binwidth = 365) + density(aes(date), fill = "red") + labs(title = "Black Hat Man Appearances over time")
black_hat |> ggplot(aes(date)) + geom_histogram(fill = "black", binwidth = 365) + labs(title = "Black Hat Man Appearances over time") + geom_density(fill = "red")
black_hat <- xkcd_characters |>
filter((str_detect(names, "\\bhat\\b") & str_detect(names, "black|man|guy")) | (str_detect(scene, "\\bhat\\b") & str_detect(scene, "black|man|guy"))) |>
filter(!str_detect(names, "boy|white")) |> group_by(num, date, weekday, title) |> count()
black_hat |> ggplot(aes(date)) + geom_histogram(fill = "black", binwidth = 365) + labs(title = "Black Hat Man Appearances over time") + geom_density(color = "red")
black_hat |> ggplot(aes(date)) + geom_density()
black_hat |> ggplot(aes(date)) + geom_histogram(fill = "black", binwidth = 365) + labs(title = "Black Hat Man Appearances over time") + geom_density(col = "red")
black_hat <- xkcd_characters |>
filter((str_detect(names, "\\bhat\\b") & str_detect(names, "black|man|guy")) | (str_detect(scene, "\\bhat\\b") & str_detect(scene, "black|man|guy"))) |>
filter(!str_detect(names, "boy|white")) |> group_by(num, date, weekday, title) |> count()
black_hat |> ggplot(aes(date)) + geom_histogram(fill = "black", binwidth = 365) + labs(title = "Black Hat Man Appearances over time") + geom_density(aes(y = 365), col = "red")
black_hat |> ggplot(aes(date)) + geom_density()
black_hat |> ggplot(aes(date)) + geom_histogram(fill = "black", binwidth = 365) + labs(title = "Black Hat Man Appearances over time") + geom_density(aes(y = ..count..), col = "red")
black_hat |> ggplot(aes(date)) + geom_histogram(fill = "black", binwidth = 365) + labs(title = "Black Hat Man Appearances over time") + geom_density(aes(y = 10), col = "red")
black_hat |> ggplot(aes(date)) + geom_histogram(fill = "black", binwidth = 365) + labs(title = "Black Hat Man Appearances over time") + geom_density(aes(y = 2 * ..count..), col = "red")
black_hat |> ggplot(aes(date)) + geom_histogram(fill = "black", binwidth = 365) + labs(title = "Black Hat Man Appearances over time") + geom_density(aes(y = 365 * ..count..), col = "red")
beret <- xkcd_characters |> filter(str_detect(names, "beret") | str_detect(scene, "beret"))
beret
beret <- xkcd_characters |> filter(str_detect(names, "beret") | str_detect(scene, "beret")) |> group_by(num, date, weekday, title) |> count()
beret
beret <- xkcd_characters |> filter(str_detect(names, "beret") | str_detect(scene, "beret")) |> group_by(num, date, weekday, title) |> count()
nrow(beret) / 103
black_hat <- xkcd_characters |>
filter((str_detect(names, "\\bhat\\b") & str_detect(names, "black|man|guy")) | (str_detect(scene, "\\bhat\\b") & str_detect(scene, "black|man|guy"))) |>
filter(!str_detect(names, "boy|white")) |> group_by(num, date, weekday, title) |> count()
nrow(black_hat) / 174
black_hat |> ggplot(aes(date)) + geom_histogram(fill = "black", binwidth = 365) +
labs(title = "Black Hat Man Appearances over time") + geom_density(aes(y = 365 * ..count..), col = "red")
specialComics |> ggplot(aes(date)) + geom_histogram(binwidth = 365) + labs(title = "Special Comics by Year")
beret <- xkcd_characters |> filter(str_detect(names, "beret") | str_detect(scene, "beret")) |> group_by(num, date, weekday, title) |> count()
nrow(beret) / 103
beret |> ggplot(aes(date)) + geom_histogram(fill = "black", binwidth = 365) +
labs(title = "Beret Man Appearances over time") + geom_density(aes(y = 365 * ..count..), col = "red")
specialComics |> mutate(year = format(date, "%Y")) |> ggplot(aes(year)) + geom_bar() + labs(title = "Special Comics by Year")
hasLink |> mutate(year = format(date, "%Y")) |> ggplot(aes(year)) + geom_bar() + labs(title = "Comics with Links by Year")
hasNews |> mutate(year = format(date, "%Y")) |> ggplot(aes(year)) + geom_bar() + labs(title = "Comics with News by Year")
black_hat <- xkcd_characters |>
filter((str_detect(names, "\\bhat\\b") & str_detect(names, "black|man|guy")) | (str_detect(scene, "\\bhat\\b") & str_detect(scene, "black|man|guy"))) |>
filter(!str_detect(names, "boy|white")) |> group_by(num, date, weekday, title) |> count()
nrow(black_hat) / 174
black_hat |> mutate(year = format(date, "%Y")) |> ggplot(aes(year)) + geom_bar(fill = "black") +
labs(title = "Black Hat Man Appearances over time") + geom_density(aes(y = 365 * ..count..), col = "red")
black_hat <- xkcd_characters |>
filter((str_detect(names, "\\bhat\\b") & str_detect(names, "black|man|guy")) | (str_detect(scene, "\\bhat\\b") & str_detect(scene, "black|man|guy"))) |>
filter(!str_detect(names, "boy|white")) |> group_by(num, date, weekday, title) |> count()
nrow(black_hat) / 174
black_hat |> mutate(year = format(date, "%Y")) |> ggplot(aes(year)) + geom_bar(fill = "black") +
labs(title = "Black Hat Man Appearances over time")
beret <- xkcd_characters |> filter(str_detect(names, "beret") | str_detect(scene, "beret")) |> group_by(num, date, weekday, title) |> count()
nrow(beret) / 103
beret |> mutate(year = format(date, "%Y")) |> ggplot(aes(year), fill = year) +
labs(title = "Beret Man Appearances over time")
beret <- xkcd_characters |> filter(str_detect(names, "beret") | str_detect(scene, "beret")) |> group_by(num, date, weekday, title) |> count()
nrow(beret) / 103
beret |> mutate(year = format(date, "%Y")) |> ggplot(aes(year, fill = year)) +
labs(title = "Beret Man Appearances over time")
beret <- xkcd_characters |> filter(str_detect(names, "beret") | str_detect(scene, "beret")) |> group_by(num, date, weekday, title) |> count()
nrow(beret) / 103
beret |> mutate(year = format(date, "%Y")) |> ggplot(aes(year, fill = year)) + geom_bar()
labs(title = "Beret Man Appearances over time")
beret <- xkcd_characters |> filter(str_detect(names, "beret") | str_detect(scene, "beret")) |> group_by(num, date, weekday, title) |> count()
nrow(beret) / 103
beret |> mutate(year = format(date, "%Y")) |> ggplot(aes(year, fill = year)) + geom_bar(show.legend = FALSE)
labs(title = "Beret Man Appearances over time")
beret <- xkcd_characters |> filter(str_detect(names, "beret") | str_detect(scene, "beret")) |> group_by(num, date, weekday, title) |> count()
nrow(beret) / 103
beret |> mutate(year = format(date, "%Y")) |> ggplot(aes(year, fill = year)) + geom_bar(show.legend = FALSE) +
labs(title = "Beret Man Appearances over time")
no_transcript <- xkcd_transcript |> filter(transcript == "")
no_transcript |> ggplot(aes(date)) |> geom_density(fill = "blue")
no_transcript <- xkcd_transcript |> filter(transcript == "")
no_transcript |> ggplot(aes(date)) |> geom_density(fill = "blue")
no_transcript <- xkcd_transcript |> filter(transcript == "")
no_transcript |> ggplot(aes(date)) + geom_density(fill = "blue")
no_transcript
xkcd_transcript
no_transcript <- xkcd_transcript |> filter(is.na(transcript |> na_if("")))
no_transcript
no_transcript |> ggplot(aes(date)) + geom_density(fill = "blue")
no_transcript
xkcd_transcript
xkcd_transcript
no_transcript <- xkcd_transcript |> filter(is.na(dialog |> na_if("")))
no_transcript
no_transcript |> ggplot(aes(date)) + geom_density(fill = "blue")
no_transcript <- xkcd_transcript |> filter(is.na(dialog |> na_if(" ")))
no_transcript
no_transcript <- xkcd_transcript |> filter(is.na(transcript |> na_if(" ")))
no_transcript
xkcd_transcript[2849,]
no_transcript <- xkcd_transcript |> filter(is.na(transcript))
no_transcript
xkcd_transcript[2849,]
no_transcript <- xkcd_transcript |> filter(transcript == " NA")
no_transcript
no_transcript |> ggplot(aes(date)) + geom_density(fill = "blue")
no_transcript <- xkcd_transcript |> filter(transcript == " NA")
no_transcript
no_transcript |> ggplot(aes(date)) + geom_density(color = "blue")
no_transcript <- xkcd_transcript |> filter(transcript == " NA")
no_transcript
no_transcript |> mutate(year = format(date, "%Y")) |> ggplot(aes(year, fill = year)) + geom_bar()
no_transcript |> filter(format(date, "%Y") == 2015)
union(beret[-"n"], black_hat[-"n"])
union(beret[-"n",], black_hat[-"n",])
union(beret[-n,], black_hat[-n,])
ncol(black_hat)
union(beret[-5,], black_hat[-5,])
intersect(beret[-5,], black_hat[-5,])
black_hat <- xkcd_characters |>
filter((str_detect(names, "\\bhat\\b") & str_detect(names, "black|man|guy")) | (str_detect(scene, "\\bhat\\b") & str_detect(scene, "black|man|guy"))) |>
filter(!str_detect(names, "boy|white")) |> group_by(num, date, weekday, title) |> count()
nrow(black_hat) / 174
ncol(black_hat)
black_hat |> mutate(year = format(date, "%Y")) |> ggplot(aes(year)) + geom_bar(fill = "black") +
labs(title = "Black Hat Man Appearances over time")
beret <- xkcd_characters |> filter(str_detect(names, "beret") | str_detect(scene, "beret")) |> group_by(num, date, weekday, title) |> count()
nrow(beret) / 103
beret |> mutate(year = format(date, "%Y")) |> ggplot(aes(year, fill = year)) + geom_bar(show.legend = FALSE) +
labs(title = "Beret Man Appearances over time")
no_transcript <- xkcd_transcript |> filter(transcript == " NA")
no_transcript
no_transcript |> mutate(year = format(date, "%Y")) |> ggplot(aes(year, fill = year)) + geom_bar()
no_transcript |> filter(format(date, "%Y") == 2015)
no_transcript <- xkcd_transcript |> filter(transcript == " NA")
no_transcript |> mutate(year = format(date, "%Y")) |> ggplot(aes(year, fill = year)) + geom_bar() + labs(title = "Comics Without Transcripts Over Time")
no_transcript |> filter(format(date, "%Y") == 2015)
black_hat <- xkcd_characters |>
filter((str_detect(names, "\\bhat\\b") & str_detect(names, "black|man|guy")) | (str_detect(scene, "\\bhat\\b") & str_detect(scene, "black|man|guy"))) |>
filter(!str_detect(names, "boy|white")) |> group_by(num, date, weekday, title) |> count()
nrow(black_hat) / 174
ncol(black_hat)
black_hat |> mutate(year = format(date, "%Y")) |> ggplot(aes(year)) + geom_bar(fill = "black") +
labs(title = "Black Hat Man Appearances Over Time")
beret <- xkcd_characters |> filter(str_detect(names, "beret") | str_detect(scene, "beret")) |> group_by(num, date, weekday, title) |> count()
nrow(beret) / 103
beret |> mutate(year = format(date, "%Y")) |> ggplot(aes(year, fill = year)) + geom_bar(show.legend = FALSE) +
labs(title = "Beret Man Appearances Over Time")
no_transcript <- xkcd_transcript |> filter(transcript == " NA")
no_transcript |> mutate(year = format(date, "%Y")) |> ggplot(aes(year, fill = year)) + geom_bar(show.legend = FALSE ) + labs(title = "Comics Without Transcripts Over Time")
no_transcript |> filter(format(date, "%Y") == 2015)
if (!require("tidyverse")) {
install.packages("tidyverse")
}
if (!require("ggwordcloud")) {
install.packages("ggwordcloud")
}
library("tidyverse")
if (!require("MASS")) {
install.packages("MASS")
}
library(MASS)
xkcd_for_fit <- xkcd_transcript |> mutate(has_black_hat = num %in% black_hat$num, has_beret = num %in% beret$num)
head(xkcd_for_fit)
xkcd_for_fit <- (xkcd_transcript |> mutate(has_black_hat = num %in% black_hat$num, has_beret = num %in% beret$num))[1:1500,]
xkcd_sample <- xkcd_for_fit |> sample(750)
xkcd_for_fit <- (xkcd_transcript |> mutate(has_black_hat = num %in% black_hat$num, has_beret = num %in% beret$num))[1:1500,]
head(xkcd_for_fit)
xkcd_for_fit
xkcd_sample <- xkcd_for_fit |> sample(750)
xkcd_sample <- xkcd_for_fit |> sample(size = 750)
xkcd_sample <- xkcd_for_fit |> sample(1500, 750)
sample <- xkcd_for_fit |> sample(1500, 750)
xkcd_for_fit <- (xkcd_transcript |> mutate(has_black_hat = num %in% black_hat$num, has_beret = num %in% beret$num))[1:1500,]
sample <- xkcd_for_fit |> sample(1500, 750)
xkcd_sample <- xkcd_for_fit[sample,]
xkcd_for_fit <- (xkcd_transcript |> mutate(has_black_hat = num %in% black_hat$num, has_beret = num %in% beret$num))[1:1500,]
sample <- sample(1500, 750)
xkcd_sample <- xkcd_for_fit[sample,]
xkcd_test <- xkcd_for_fit[-sample,]
lda.fit <- lda(has_black_hat ~ date, data = xkcd_sample)
lda.fit
xkcd_for_fit <- (xkcd_transcript |> mutate(has_black_hat = num %in% black_hat$num, has_beret = num %in% beret$num))[1:1500,]
sample <- sample(1500, 750)
xkcd_sample <- xkcd_for_fit[sample,]
xkcd_test <- xkcd_for_fit[-sample,]
lda.fit <- lda(has_black_hat ~ date, data = xkcd_sample)
lda.fit
lda.pred <- predict(lda.fit, data = xkcd_test)
names(lda.fit)
xkcd_for_fit <- (xkcd_transcript |> mutate(has_black_hat = num %in% black_hat$num, has_beret = num %in% beret$num))[1:1500,]
sample <- sample(1500, 750)
xkcd_sample <- xkcd_for_fit[sample,]
xkcd_test <- xkcd_for_fit[-sample,]
lda.fit <- lda(has_black_hat ~ date, data = xkcd_sample)
lda.fit
lda.pred <- predict(lda.fit, data = xkcd_test)
names(lda.pred)
lda.class = lda.pred$class
table(lda.class, xkcd_text)
table(lda.class, xkcd_test)
table(lda.class, sample)
table(lda.class, has_black_hat)
names(lda.pred)
table(lda.class, default)
table(lda.class, xkcd_test$has_black_hat)
